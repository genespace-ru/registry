versions:
  type: collection
  displayName: Versions
  doc: Repository versions - Git branches and tags.
  primaryKey: ID
  
  scheme:
    columns:
    - ID:
        type: KEYTYPE
        autoIncrement: true
        primaryKey: true
    - repository:
        type: KEYTYPE
        reference: repositories.ID
        doc: repository
    - name:
        type: VARCHAR(200)
        doc: branch or tga name
    - commit:
        type: VARCHAR(40)
        doc: Git commit
    - dateModified:
        type: DATETIME
        doc: date of last update to Git reference
    - type:
        type: ENUM(branch, tag)
        defaultValue: "'branch'"
        doc: type of commit - branch or tag
    - doi:
        type: VARCHAR(50)
        canBeNull: true
        doc: DOI for this version of Git repository     
    - whoInserted___:
        type: VARCHAR(100)
        defaultValue: '''Administrator'''
    - creationDate___:
        type: DATETIME
        defaultValue: CURRENT_TIMESTAMP
    - whoModified___:
        type: VARCHAR(100)
        canBeNull: true
    - modificationDate___:
        type: DATETIME
        canBeNull: true
        
  queries:
  - '*** Selection view ***':
      code: |-
        SELECT
          v.ID,
          v.name,
          v.valid,
        FROM versions v
        ORDER BY dateModified DESC
  - ForResourceCard:
      type: 1D
      invisible: true
      layout: '{"hideTitle":"true", "quickType":"select"}'
      roles: [Administrator]
      code: |-
        SELECT
          v.ID,
          v.ID AS "___verID",
          r.ID AS "___resID",
          v.name AS "Name",
          CASE WHEN v.ID == <parameter:___verID /> THEN ''
          ELSE '<link table="resources" queryName="Resource card" using="___resID,___verID" columns="ID,___verID" />'  END AS ";Name",
          COALESCE('<a target="_blank" href="https://github.com/' || repos.url || '/commit/' || v.commit || '">Open in github</a>', '') AS "Git Reference",
          r.language AS "Language",
          r2v.valid,
          v.dateModified AS "Date Modified"
        FROM versions v
        JOIN resource2versions r2v ON r2v.version = v.ID
        JOIN repositories repos ON v.repository = repos.ID
        JOIN resources r ON r2v.resource = r.ID
            WHERE r2v.resource = <parameter:___resID />
            ORDER BY v.ID
          
